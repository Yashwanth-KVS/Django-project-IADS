<!-- templates/tweets/post_responses.html -->
{% extends "tweets/base.html" %}

{% block title %}Post Responses - Enviro Chat{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Post Responses</h1>
    <div class="scroll-container">
        {% for post in posts %}
            <div class="post">
{#                <h5 class="post-header">Post #{{ post.id }}</h5>#}
                {% if post.image %}
                    <div class="image-container">
                        <img src="{{ post.image.url }}" alt="Uploaded Image">
                    </div>
                {% endif %}
                {% if post.video %}
                    <div class="video-container">
                        <video controls>
                            <source src="{{ post.video.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    </div>
                {% endif %}
                <p class="content-text">{{ post.content }}</p>
                <div class="post-buttons">
                    <button class="btn btn-primary" onclick="vote('{{ post.id }}', 'upvote')">
                        üëç <span id="likes-{{ post.id }}">{{ post.likes }}</span>
                    </button>
                    <button class="btn btn-secondary" onclick="vote('{{ post.id }}', 'downvote')">
                        üëé <span id="dislikes-{{ post.id }}">{{ post.dislikes }}</span>
                    </button>
                </div>
            </div>
        {% endfor %}
    </div>
</div>

{% block extra_js %}
<script>
function vote(contentId, action) {
    fetch(`/vote/${contentId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({ action: action }),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Server response:', data); // Debugging line
        if (data.success) { // Ensure success key is returned from the server
            document.getElementById(`likes-${contentId}`).innerText = data.likes;
            document.getElementById(`dislikes-${contentId}`).innerText = data.dislikes;
        } else {
            console.error('Error updating vote:', data.error); // Error handling
        }
    })
    .catch(error => console.error('Fetch error:', error)); // Error handling
}
</script>
{% endblock %}
{% endblock %}
